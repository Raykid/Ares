var ares;(function(ares){var pixijs;(function(pixijs){function addCommand(name,command){if(!pixijs.commands[name])pixijs.commands[name]=command}pixijs.addCommand=addCommand;function textContent(context){context.entity.createWatcher(context.target,context.exp,context.scope,function(value){var text=context.target;text.text=value})}pixijs.textContent=textContent;pixijs.commands={tpl:function(context){var template=context.compiler.getTemplate(context.exp);if(!template)return;template=cloneObject(template,true);var target=context.target;var parent=target.parent;parent.addChildAt(template,parent.getChildIndex(target));parent.removeChild(target);target.destroy();context.compiler.compile(template,context.scope);return template},prop:function(context){var target=context.target;context.entity.createWatcher(context.target,context.exp,context.scope,function(value){if(context.subCmd!=""){target[context.subCmd]=value}else{for(var name in value){target[name]=value[name]}}});return target},on:function(context){if(context.subCmd!=""){var handler=context.scope[context.exp]||window[context.exp];if(typeof handler=="function"){context.target.on(context.subCmd,handler,context.scope)}else{context.target.on(context.subCmd,function(evt){var scope=Object.create(context.scope);scope.$event=evt;scope.$target=context.target;ares.utils.runExp(context.exp,scope)})}}return context.target},"if":function(context){var compiled=false;var refNode=new PIXI.DisplayObject;refNode.interactive=refNode.interactiveChildren=false;var parent=context.target.parent;var index=parent.getChildIndex(context.target);parent.addChildAt(refNode,index);var watcher=context.entity.createWatcher(context.target,context.exp,context.scope,function(value){if(!refNode.parent){watcher.dispose();return}if(value==true){if(!compiled){context.compiler.compile(context.target,context.scope);compiled=true}if(!context.target.parent){var index=refNode.parent.getChildIndex(refNode);refNode.parent.addChildAt(context.target,index)}}else{if(context.target.parent){context.target.parent.removeChild(context.target)}}});return context.target},"for":function(context){var reg=/^\s*(\S+)\s+in\s+(\S+)\s*$/;var res=reg.exec(context.exp);if(!res){console.error("for命令表达式错误："+context.exp);return}var itemName=res[1];var arrName=res[2];var parent=context.target.parent;var sNode=new PIXI.DisplayObject;sNode.interactive=sNode.interactiveChildren=false;var eNode=new PIXI.DisplayObject;eNode.interactive=eNode.interactiveChildren=false;var index=parent.getChildIndex(context.target);parent.addChildAt(sNode,index);parent.addChildAt(eNode,index+1);parent.removeChild(context.target);var watcher=context.entity.createWatcher(context.target,arrName,context.scope,function(value){if(!sNode.parent){watcher.dispose();return}var bIndex=parent.getChildIndex(sNode);var eIndex=parent.getChildIndex(eNode);for(var i=eIndex-1;i>bIndex;i--){parent.removeChildAt(i).destroy()}if(typeof value=="number"){var temp=[];for(var i=0;i<value;i++){temp.push(i)}value=temp}var curIndex=0;for(var key in value){var newNode=cloneObject(context.target,true);parent.addChildAt(newNode,bIndex+1+curIndex);var newScope=Object.create(context.scope);Object.defineProperty(newScope,"$index",{configurable:true,enumerable:false,value:value instanceof Array?parseInt(key):key,writable:false});Object.defineProperty(newScope,itemName,{configurable:true,enumerable:true,value:value[key],writable:false});context.compiler.compile(newNode,newScope);curIndex++}});return context.target}};function cloneObject(target,deep){var result;if(!target||typeof target!="object")return target;if(typeof target["clone"]=="function")return target["clone"]();if(!deep){result=Object.create(target["__proto__"]||null);for(var k in target){result[k]=target[k]}return result}var cls=target.constructor||Object;try{result=new cls}catch(err){return null}target["__ares_cloning__"]=result;var keys=Object.keys(target);for(var i in keys){var key=keys[i];if(key=="__ares_cloning__")continue;if(key=="_texture"&&target instanceof PIXI.Text)continue;if(key=="parent"&&target instanceof PIXI.DisplayObject){if(target["parent"]&&target["parent"]["__ares_cloning__"]){result["parent"]=target["parent"]["__ares_cloning__"]}else{result["parent"]=target["parent"]}continue}if(key=="_events"&&target instanceof PIXI.utils.EventEmitter){result["_events"]=cloneObject(target["_events"],false);for(var k in target["_events"]){var temp=target["_events"][k];if(temp.context==target){result["_events"][k].context=result}}continue}if(key=="children"&&target instanceof PIXI.DisplayObject){var children=target["children"];for(var j in children){var child=cloneObject(children[j],true);result["addChild"](child)}continue}var oriValue=target[key];if(oriValue&&oriValue["__ares_cloning__"]){result[key]=oriValue["__ares_cloning__"]}else{var value=cloneObject(oriValue,true);if(value!==null)result[key]=value}}delete target["__ares_cloning__"];return result}})(pixijs=ares.pixijs||(ares.pixijs={}))})(ares||(ares={}));var ares;(function(ares){var pixijs;(function(pixijs){var PIXICompiler=function(){function PIXICompiler(root,config,tplDict){this._nameDict={};this._root=root;this._config=config;this._tplDict=tplDict||{}}Object.defineProperty(PIXICompiler.prototype,"root",{get:function(){return this._root},enumerable:true,configurable:true});PIXICompiler.prototype.init=function(entity){this._entity=entity;this.compile(this._root,entity.data)};PIXICompiler.prototype.compile=function(node,scope){var tplName=node["a-tplName"]||node["a_tplName"];if(tplName&&this.setTemplate(tplName,node)){delete node["a-tplName"];delete node["a_tplName"];node.parent&&node.parent.removeChild(node);return}var hasLazyCompile=false;var name=node.name;if(name)this._nameDict[name]=node;var keys=[];for(var t in node){if(t.indexOf("a-")==0||t.indexOf("a_")==0){keys.push(t)}}var conf=this._config&&this._config[name];for(var t in conf){if(t.indexOf("a-")!=0&&t.indexOf("a_")!=0)t="a-"+t;keys.push(t)}var cmdsToCompile=[];for(var i=0,len=keys.length;i<len;i++){var key=keys[i];var bIndex=2;var eIndex=key.indexOf(":");if(eIndex<0)eIndex=key.indexOf("$");if(eIndex<0)eIndex=key.length;var cmdName=key.substring(bIndex,eIndex);var exp;if(conf)exp=conf[key]||conf[cmdName]||node[key];else exp=node[key];var subCmd=key.substr(eIndex+1);var cmd=pixijs.commands[cmdName];if(!cmd){cmd=pixijs.commands["prop"];subCmd=cmdName||""}var cmdToCompile={propName:key,cmd:cmd,ctx:{scope:scope,target:node,subCmd:subCmd,exp:exp,compiler:this,entity:this._entity}};if(cmdName=="tpl")cmdsToCompile.unshift(cmdToCompile);else cmdsToCompile.push(cmdToCompile);if(cmdName=="if"||cmdName=="for"){hasLazyCompile=true;cmdsToCompile.splice(0,cmdsToCompile.length-1);break}}for(var i=0,len=cmdsToCompile.length;i<len;i++){var cmdToCompile=cmdsToCompile[i];cmdToCompile.ctx.target=node;delete cmdToCompile.ctx.target[cmdToCompile.propName];node=cmdToCompile.cmd(cmdToCompile.ctx)}if(!hasLazyCompile){if(node instanceof PIXI.Text){this.compileTextContent(node,scope)}if(node instanceof PIXI.Container){var children=node.children;var nextChild;for(var i=0,len=children.length;i<len;i++){var child=children[i];nextChild=children[i+1];this.compile(child,scope);var nextI=children.indexOf(nextChild);if(nextI>=0&&nextI!=i+1){i=nextI-1;len=children.length}}}}};PIXICompiler.prototype.getTemplate=function(name){return this._tplDict[name]};PIXICompiler.prototype.setTemplate=function(name,tpl){if(!name||!tpl)return null;if(this._tplDict[name])return null;this._tplDict[name]=tpl;return tpl};PIXICompiler.prototype.compileTextContent=function(text,scope){var value=text.text;if(PIXICompiler._textExpReg.test(value)){var exp=this.parseTextExp(value);pixijs.textContent({scope:scope,target:text,subCmd:"",exp:exp,compiler:this,entity:this._entity})}};PIXICompiler.prototype.parseTextExp=function(exp){var reg=PIXICompiler._textExpReg;for(var result=reg.exec(exp);result!=null;result=reg.exec(exp)){exp=result[1]+"${"+result[2]+"}"+result[3]}return"`"+exp+"`"};return PIXICompiler}();PIXICompiler._textExpReg=/(.*?)\{\{(.*?)\}\}(.*)/;pixijs.PIXICompiler=PIXICompiler})(pixijs=ares.pixijs||(ares.pixijs={}))})(ares||(ares={}));var module=module||{};module.exports=ares.pixijs;