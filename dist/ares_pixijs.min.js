(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["ares_pixijs"]=factory();else root["ares_pixijs"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=6)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function createEvalFunc(exp){var func;try{func=Function("scope","with(scope){return "+exp+"}")}catch(err){var sepStr=exp.indexOf('"')<0?'"':"'";var reg=/([^\\]?)`/g;exp=exp.replace(reg,"$1"+sepStr);reg=/\$\{(.*?)\}/g;exp=exp.replace(reg,sepStr+"+($1)+"+sepStr);func=Function("scope","with(scope){return "+exp+"}")}return func}exports.createEvalFunc=createEvalFunc;function evalExp(exp,scope){return createEvalFunc(exp)(scope)}exports.evalExp=evalExp;function createRunFunc(exp){return createEvalFunc("(function(){"+exp+"})()")}exports.createRunFunc=createRunFunc;function runExp(exp,scope){createRunFunc(exp)(scope)}exports.runExp=runExp},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Utils_1=__webpack_require__(0);var Watcher=function(){function Watcher(entity,target,exp,scope,callback){this._disposed=false;this._entity=entity;this._uid=Watcher._uid++;this._target=target;this._exp=exp;this._scope=scope;this._expFunc=Utils_1.createEvalFunc(exp);this._callback=callback;this.update()}Object.defineProperty(Watcher.prototype,"uid",{get:function(){return this._uid},enumerable:true,configurable:true});Watcher.prototype.getValue=function(){if(this._disposed)return null;var value=null;Watcher.updating=this;Object.defineProperty(this._scope,"$root",{configurable:true,enumerable:false,value:this._entity.compiler.root,writable:false});Object.defineProperty(this._scope,"$target",{configurable:true,enumerable:false,value:this._target,writable:false});try{value=this._expFunc.call(this._scope,this._scope)}catch(err){console.warn("表达式求值错误\nerr: "+err.toString()+"\nexp："+this._exp+"，scope："+JSON.stringify(this._scope))}delete this._scope["$root"];delete this._scope["$target"];Watcher.updating=null;return value};Watcher.prototype.update=function(extra){if(this._disposed)return;var value=this.getValue();if(!Watcher.isEqual(value,this._value)){this._callback&&this._callback(value,this._value,extra);this._value=Watcher.deepCopy(value)}};Watcher.prototype.dispose=function(){if(this._disposed)return;this._value=null;this._target=null;this._exp=null;this._scope=null;this._expFunc=null;this._callback=null;this._disposed=true};Watcher.isEqual=function(a,b){return a==b||(Watcher.isObject(a)&&Watcher.isObject(b)?JSON.stringify(a)==JSON.stringify(b):false)};Watcher.isObject=function(obj){return obj&&typeof obj=="object"};Watcher.deepCopy=function(from){if(Watcher.isObject(from)){return JSON.parse(JSON.stringify(from))}else{return from}};Watcher.updating=null;Watcher._uid=0;return Watcher}();exports.Watcher=Watcher},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Utils_1=__webpack_require__(0);exports.commands={set:function(context){Utils_1.runExp(context.data.subCmd+"="+context.data.exp,context.scope);return context.target},bind:function(context){context.entity.createWatcher(context.target,context.data.exp,context.scope,function(value){if(context.data.subCmd)Utils_1.runExp(context.data.subCmd+"="+context.data.exp,context.scope)});return context.target}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Watcher_1=__webpack_require__(1);var Dep_1=__webpack_require__(5);var Mutator=function(){function Mutator(){}Mutator.mutate=function(data){if(!data||typeof data!="object")return;if(!data.__ares_mutated__){for(var key in data){Mutator.mutateObject(data,key,data[key])}Object.defineProperty(data,"__ares_mutated__",{value:true,writable:false,enumerable:false,configurable:false})}return data};Mutator.mutateObject=function(data,key,value){var dep=new Dep_1.Dep;Object.defineProperty(data,key,{enumerable:true,configurable:false,get:function(){var watcher=Watcher_1.Watcher.updating;if(watcher)dep.watch(watcher);return value},set:function(v){if(v==value)return;value=v;if(Array.isArray(v))Mutator.mutateArray(v,dep);else Mutator.mutate(v);dep.notify()}});Mutator.mutate(value)};Mutator.mutateArray=function(arr,dep){arr["__proto__"]=Mutator.defineReactiveArray(dep);for(var i=0,len=arr.length;i<len;i++){Mutator.mutate(arr[i])}};Mutator.defineReactiveArray=function(dep){var proto=Array.prototype;var result=Object.create(proto);Mutator._arrMethods.forEach(function(method){var oriMethod=proto[method];Object.defineProperty(result,method,{value:function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var result=oriMethod.apply(this,args);var inserted;switch(method){case"push":case"unshift":inserted=args;break;case"splice":inserted=args.slice(2);break}if(inserted&&inserted.length){Mutator.mutateArray(inserted,dep)}dep.notify({method:args});return result}})});Object.defineProperty(result,"$set",{value:function(index,value){if(index>=this.length)index=this.length;return this.splice(index,1,value)[0]}});Object.defineProperty(result,"$remove",{value:function(item){var index=this.indexOf(item);if(index>-1)return this.splice(index,1);return null}});return result};Mutator._arrMethods=["push","pop","unshift","shift","splice","sort","reverse"];return Mutator}();exports.Mutator=Mutator},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Mutator_1=__webpack_require__(3);var Watcher_1=__webpack_require__(1);var Commands_1=__webpack_require__(2);exports.defaultCmdRegExp=/^(data\-)?a[\-_](\w+)([:\$](.+))?$/;function bind(data,compiler,options){return new Ares(data,compiler,options)}exports.bind=bind;var Ares=function(){function Ares(data,compiler,options){this._data=Mutator_1.Mutator.mutate(data);this._compiler=compiler;this._options=options;this._compiler.init(this);if(this._options&&this._options.inited){this._options.inited.call(this._data,this)}}Object.defineProperty(Ares.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});Object.defineProperty(Ares.prototype,"compiler",{get:function(){return this._compiler},enumerable:true,configurable:true});Ares.prototype.createWatcher=function(target,exp,scope,callback){return new Watcher_1.Watcher(this,target,exp,scope,callback)};Ares.prototype.parseCommand=function(key,value,cmdRegExp){var result=(cmdRegExp||exports.defaultCmdRegExp).exec(key);if(!result)return null;var key=result[0];var cmdName=result[2];var exp=value;var subCmd=result[4]||"";return{cmdName:cmdName,subCmd:subCmd,propName:key,exp:exp}};Ares.prototype.testCommand=function(data){if(!data)return false;var cmd=Commands_1.commands[data.cmdName];return cmd!=null};Ares.prototype.execCommand=function(data,target,scope){if(!data||!scope)return false;var cmd=Commands_1.commands[data.cmdName];if(!cmd)return false;cmd({target:target,scope:scope,entity:this,data:data});return true};return Ares}();exports.Ares=Ares},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Dep=function(){function Dep(){this._map={}}Dep.prototype.watch=function(watcher){if(!this._map[watcher.uid]){this._map[watcher.uid]=watcher}};Dep.prototype.notify=function(extra){for(var uid in this._map){var watcher=this._map[uid];watcher.update(extra)}};return Dep}();exports.Dep=Dep},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var PIXICommands_1=__webpack_require__(8);var _tplDict={};function getTemplate(name){return _tplDict[name]}exports.getTemplate=getTemplate;function setTemplate(name,tpl){if(!name||!tpl)return null;if(_tplDict[name])return null;_tplDict[name]=tpl;return tpl}exports.setTemplate=setTemplate;var PIXICompiler=function(){function PIXICompiler(root,renderer,config,tplDict){this._nameDict={};this._root=root;this._renderer=renderer;this._config=config;this._tplDict=tplDict||{}}Object.defineProperty(PIXICompiler.prototype,"root",{get:function(){return this._root},enumerable:true,configurable:true});Object.defineProperty(PIXICompiler.prototype,"renderer",{get:function(){return this._renderer},enumerable:true,configurable:true});PIXICompiler.prototype.parseCmd=function(node){var datas=[];var data;for(var t in node){data=this._entity.parseCommand(t,node[t]);if(data)datas.push(data)}var conf=this._config&&this._config[node.name];for(var t in conf){if(t.indexOf("a-")!=0&&t.indexOf("a_")!=0)t="a-"+t;data=this._entity.parseCommand(t,node[t]);if(data)datas.push(data)}var cmdNameDict={};for(var i=0,len=datas.length;i<len;i++){data=datas[i];if(!cmdNameDict[data.cmdName])cmdNameDict[data.cmdName]=[];cmdNameDict[data.cmdName].push(data)}return cmdNameDict};PIXICompiler.prototype.parseTpl=function(node){var tplName=node["a-tplName"]||node["a_tplName"];if(tplName){var callback=function(){delete node["a-tplName"];delete node["a_tplName"];delete node["a-tplGlobal"];delete node["a_tplGlobal"];node.parent&&node.parent.removeChild(node)};if(node["a-tplGlobal"]=="true"||node["a_tplGlobal"]=="true"){if(setTemplate(tplName,node)){callback();return true}}else{if(this.setTemplate(tplName,node)){callback();return true}}}return false};PIXICompiler.prototype.init=function(entity){this._entity=entity;this.compile(this._root,entity.data)};PIXICompiler.prototype.compile=function(node,scope){if(this.parseTpl(node))return;var hasLazyCompile=false;var name=node.name;if(name)this._nameDict[name]=node;var cmdDict=this.parseCmd(node);var cmdsToCompile=[];flag:for(var cmdName in cmdDict){var cmdDatas=cmdDict[cmdName];for(var i=0,len=cmdDatas.length;i<len;i++){var cmdData=cmdDatas[i];var isCommonCmd=this._entity.testCommand(cmdData);var cmd=PIXICommands_1.commands[cmdName];if(!isCommonCmd&&!cmd){cmdData.cmdName="prop";cmdData.subCmd=cmdName||"";cmd=PIXICommands_1.commands[cmdData.cmdName]}var cmdToCompile={propName:cmdData.propName,cmd:cmd,ctx:{scope:scope,target:node,compiler:this,entity:this._entity,cmdData:cmdData,cmdDict:cmdDict}};if(cmdData.cmdName=="tpl")cmdsToCompile.unshift(cmdToCompile);else cmdsToCompile.push(cmdToCompile);if(cmdData.cmdName=="if"||cmdData.cmdName=="for"){hasLazyCompile=true;cmdsToCompile.splice(0,cmdsToCompile.length-1);break flag}}}for(var i=0,len=cmdsToCompile.length;i<len;i++){var cmdToCompile=cmdsToCompile[i];cmdToCompile.ctx.target=node;delete cmdToCompile.ctx.target[cmdToCompile.propName];var isCommonCmd=this._entity.execCommand(cmdToCompile.ctx.cmdData,node,scope);if(!isCommonCmd)node=cmdToCompile.cmd(cmdToCompile.ctx)}if(!hasLazyCompile){if(node instanceof PIXI.Text){this.compileTextContent(node,scope,cmdDict)}if(node instanceof PIXI.Container){var children=node.children;var nextChild;for(var i=0,len=children.length;i<len;i++){var child=children[i];nextChild=children[i+1];this.compile(child,scope);var nextI=children.indexOf(nextChild);if(nextI>=0&&nextI!=i+1){i=nextI-1;len=children.length}}}}};PIXICompiler.prototype.getTemplate=function(name){return this._tplDict[name]};PIXICompiler.prototype.setTemplate=function(name,tpl){if(!name||!tpl)return null;if(this._tplDict[name])return null;this._tplDict[name]=tpl;return tpl};PIXICompiler.prototype.compileTextContent=function(text,scope,cmdDict){var value=text.text;if(PIXICompiler._textRegExp.test(value)){var exp=this.parseTextExp(value);PIXICommands_1.textContent({scope:scope,target:text,compiler:this,entity:this._entity,cmdData:{cmdName:"textContent",subCmd:"",propName:"",exp:exp},cmdDict:cmdDict})}};PIXICompiler.prototype.parseTextExp=function(exp){var reg=PIXICompiler._textRegExp;for(var result=reg.exec(exp);result!=null;result=reg.exec(exp)){exp=result[1]+"${"+result[2]+"}"+result[3]}return"`"+exp+"`"};PIXICompiler._textRegExp=/(.*?)\{\{(.*?)\}\}(.*)/;return PIXICompiler}();exports.PIXICompiler=PIXICompiler},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var PIXICompiler_1=__webpack_require__(6);var Utils_1=__webpack_require__(0);var ViewPortHandler_1=__webpack_require__(12);var PIXIUtils_1=__webpack_require__(11);function addCommand(name,command){if(!exports.commands[name])exports.commands[name]=command}exports.addCommand=addCommand;function textContent(context){context.entity.createWatcher(context.target,context.cmdData.exp,context.scope,function(value){var text=context.target;text.text=value})}exports.textContent=textContent;exports.commands={viewport:function(context){var cmdData=context.cmdData;var target=context.target;var exp="["+cmdData.exp+"]";var options=Utils_1.evalExp(cmdData.subCmd,context.scope);var handler=new ViewPortHandler_1.ViewPortHandler(target,options);context.entity.createWatcher(context.scope.$forTarget||target,exp,context.scope,function(value){var x=value[0]||0;var y=value[1]||0;var width=value[2]||0;var height=value[3]||0;handler.setViewPort(x,y,width,height)});return target},tpl:function(context){var cmdData=context.cmdData;var template=context.compiler.getTemplate(cmdData.exp);if(!template)template=PIXICompiler_1.getTemplate(cmdData.exp);if(!template)return context.target;template=PIXIUtils_1.PIXIUtils.cloneObject(template,true);var target=context.target;var parent=target.parent;parent.addChildAt(template,parent.getChildIndex(target));parent.removeChild(target);target.destroy();context.compiler.compile(template,context.scope);return template},prop:function(context){var cmdData=context.cmdData;var target=context.target;context.entity.createWatcher(target,cmdData.exp,context.scope,function(value){if(cmdData.subCmd!=""){target[cmdData.subCmd]=value}else{for(var name in value){target[name]=value[name]}}});return target},on:function(context){var cmdData=context.cmdData;if(cmdData.subCmd!=""){var handler=context.scope[cmdData.exp]||window[context.cmdData.exp];if(typeof handler=="function"){context.target.on(cmdData.subCmd,function(){handler.apply(this,arguments)},context.scope)}else{context.target.on(cmdData.subCmd,function(evt){var scope=Object.create(context.scope);scope.$event=evt;scope.$target=context.target;Utils_1.runExp(cmdData.exp,scope)})}}return context.target},"if":function(context){var cmdData=context.cmdData;var compiled=false;var refNode=new PIXI.Container;refNode.interactive=refNode.interactiveChildren=false;var parent=context.target.parent;var index=parent.getChildIndex(context.target);parent.addChildAt(refNode,index);var watcher=context.entity.createWatcher(context.target,cmdData.exp,context.scope,function(value){if(!refNode.parent){watcher.dispose();return}if(value==true){if(!compiled){context.compiler.compile(context.target,context.scope);compiled=true}if(!context.target.parent){var index=refNode.parent.getChildIndex(refNode);refNode.parent.addChildAt(context.target,index)}}else{if(context.target.parent){context.target.parent.removeChild(context.target)}}});return context.target},"for":function(context){var cmdData=context.cmdData;var options=Utils_1.evalExp(cmdData.subCmd,context.scope)||{};var reg=/^\s*(\S+)\s+in\s+([\s\S]+?)\s*$/;var res=reg.exec(cmdData.exp);if(!res){console.error("for命令表达式错误："+cmdData.exp);return}var itemName=res[1];var arrName=res[2];var index=context.target.parent.getChildIndex(context.target);var parent=new PIXI.Container;context.target.parent.addChildAt(parent,index);context.target.parent.removeChild(context.target);var forScope=Object.create(context.scope);Object.defineProperty(forScope,"$forTarget",{configurable:true,enumerable:false,value:context.target,writable:false});var viewportCmds=context.cmdDict["viewport"];if(viewportCmds){var viewportCmd=viewportCmds[0];if(viewportCmd){parent[viewportCmd.propName]=viewportCmd.exp;delete context.target[viewportCmd.propName]}}var forDatas=[];var viewportData;var globalRange;var orderRange;var watcher=context.entity.createWatcher(context.target,arrName,forScope,function(value){if(!parent.parent){watcher.dispose();return}if(typeof value=="number"){var temp=[];for(var i=0;i<value;i++){temp.push(i)}value=temp}for(var i=0,len=forDatas.length;i<len;i++){var forData=forDatas.pop();if(forData.target)PIXIUtils_1.PIXIUtils.returnObject(forData.target)}var bg;if(parent.children.length==1)bg=parent.getChildAt(0);else if(parent.children.length>1)throw new Error("for容器里出现了不明对象");if(!bg){bg=new PIXI.Graphics;parent.addChildAt(bg,0)}if(viewportData){globalRange=viewportData.globalRange.clone()}else{globalRange=new PIXI.Rectangle(0,0,context.compiler.renderer.width,context.compiler.renderer.height)}var maxRange=null;var isArray=value instanceof Array;var arrLength=isArray?value.length:-1;orderRange=!options.chaos&&isArray?{begin:Number.MAX_VALUE,end:-1}:null;forData=null;for(var key in value){var newOne=generateOne(key,value,arrLength,forData&&forData.target);var newScope=newOne.scope;var newNode=newOne.node;var newRange=new PIXI.Rectangle(newNode.x,newNode.y,newNode["width"],newNode["height"]);maxRange?maxRange.enlarge(newRange):maxRange=newRange;testReturn(forData,orderRange);var forData={key:key,value:value,data:newScope,bounds:new PIXI.Rectangle,parent:parent,target:newNode};newNode.getBounds(null,forData.bounds);var parentGlobalPosition=parent.getGlobalPosition();forData.bounds.x-=parentGlobalPosition.x;forData.bounds.y-=parentGlobalPosition.y;forDatas.push(forData)}testReturn(forData,orderRange);if(orderRange&&orderRange.begin>=orderRange.end)orderRange=null;bg.clear();if(maxRange){bg.beginFill(0,0);bg.drawRect(maxRange.x,maxRange.y,maxRange.width,maxRange.height);bg.endFill()}});context.compiler.compile(parent,forScope);viewportData=PIXIUtils_1.PIXIUtils.getViewportData(parent);if(viewportData){globalRange=viewportData.globalRange.clone();viewportData.observe(updateView)}return context.target;function generateOne(key,value,len,lastNode){var newNode=PIXIUtils_1.PIXIUtils.borrowObject(context.target);parent.addChild(newNode);var newScope=Object.create(forScope);Object.defineProperty(newScope,"$index",{configurable:true,enumerable:false,value:value instanceof Array?parseInt(key):key,writable:false});Object.defineProperty(newScope,"$last",{configurable:true,enumerable:false,value:lastNode,writable:false});if(len>=0){Object.defineProperty(newScope,"$length",{configurable:true,enumerable:false,value:len,writable:false})}Object.defineProperty(newScope,itemName,{configurable:true,enumerable:true,value:value[key],writable:false});context.compiler.compile(newNode,newScope);return{scope:newScope,node:newNode}}function testInViewPort(forData){var parentGlobalPosition=forData.parent.getGlobalPosition();var tempRect=forData.bounds.clone();tempRect.x+=parentGlobalPosition.x;tempRect.y+=parentGlobalPosition.y;tempRect=PIXIUtils_1.PIXIUtils.rectCross(tempRect,globalRange);return tempRect.width*tempRect.height!=0}function testReturn(forData,orderRange){if(forData&&forData.target){var index=parseInt(forData.key);if(!testInViewPort(forData)){PIXIUtils_1.PIXIUtils.returnObject(forData.target);forData.target=null;if(index<=orderRange.begin)orderRange.begin=index+1;else if(orderRange.end>index)orderRange.end=index}else{if(orderRange){if(orderRange.begin>index)orderRange.begin=index;if(orderRange.end<index+1)orderRange.end=index+1}}}}function updateView(viewport){var arrLength=forDatas.length;var curRange={begin:0,end:arrLength};if(orderRange){curRange.begin=orderRange.begin;curRange.end=orderRange.end;for(var i=orderRange.begin;i>=0;i--){if(testInViewPort(forDatas[i]))curRange.begin=i;else break}for(var i=orderRange.end,len=forDatas.length;i<len;i++){if(testInViewPort(forDatas[i]))curRange.end=i+1;else break}}for(var i=curRange.begin,end=curRange.end;i<end;i++){var forData=forDatas[i];var lastForData=forDatas[i-1];if(!forData.target){var newOne=generateOne(forData.key,forData.value,arrLength,lastForData&&lastForData.target);forData.target=newOne.node}testReturn(lastForData,curRange)}testReturn(forData,curRange);if(orderRange){if(curRange.begin<curRange.end){orderRange.begin=curRange.begin;orderRange.end=curRange.end}else if(viewportData.twowayMoving){orderRange.begin=0;orderRange.end=arrLength}}}}}},,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Ares_1=__webpack_require__(4);var PIXIUtils=function(){function PIXIUtils(){}PIXIUtils.borrowObject=function(oriTarget){if(oriTarget==null)return oriTarget;if(!(oriTarget instanceof PIXI.DisplayObject))return PIXIUtils.cloneObject(oriTarget,true);var key=oriTarget.constructor.toString();var pool=PIXIUtils._objectPool[key];if(pool==null)PIXIUtils._objectPool[key]=pool=[];var target=null;while(!target){if(pool.length>0){target=pool.shift();if(target["_destroyed"])continue;restoreProp(oriTarget,target)}else{target=PIXIUtils.cloneObject(oriTarget,true)}}return target;function restoreProp(oriTarget,curTarget){for(var propName in oriTarget){if(Ares_1.defaultCmdRegExp.test(propName))curTarget[propName]=oriTarget[propName]}for(var i in PIXIUtils._commonDisplayProps){var propName=PIXIUtils._commonDisplayProps[i];curTarget[propName]=oriTarget[propName]}if(oriTarget instanceof PIXI.Container){for(var i in oriTarget["children"]){restoreProp(oriTarget["children"][i],curTarget["children"][i])}}}};PIXIUtils.returnObject=function(target){if(target instanceof PIXI.DisplayObject){target.removeAllListeners();if(target.parent)target.parent.removeChild(target);var key=target.constructor.toString();var pool=PIXIUtils._objectPool[key];if(pool==null)PIXIUtils._objectPool[key]=pool=[];pool.push(target)}};PIXIUtils.rectCross=function(rect1,rect2){var left=Math.max(rect1.x,rect2.x);var right=Math.min(rect1.x+rect1.width,rect2.x+rect2.width);var width=right-left;if(width<0)width=0;var top=Math.max(rect1.y,rect2.y);var bottom=Math.min(rect1.y+rect1.height,rect2.y+rect2.height);var height=bottom-top;if(height<0)height=0;return new PIXI.Rectangle(left,top,width,height)};PIXIUtils.cloneObject=function(target,deep){var result;if(!target||typeof target!="object")return target;if(target instanceof PIXI.ObservablePoint){return new PIXI.ObservablePoint(target["cb"],target["scope"]["__ares_cloning__"],target["x"],target["y"])}if(typeof target["clone"]=="function")return target["clone"]();if(!deep){result=Object.create(target["__proto__"]||null);for(var k in target){result[k]=target[k]}return result}var cls=target.constructor||Object;try{result=new cls}catch(err){return null}target["__ares_cloning__"]=result;for(var key in target){if(key=="__ares_cloning__")continue;if(typeof target[key]=="function"&&!target.hasOwnProperty(key))continue;if(key=="_texture"&&target instanceof PIXI.Text)continue;if(key=="parent"&&target instanceof PIXI.DisplayObject){if(target["parent"]&&target["parent"]["__ares_cloning__"]){result["parent"]=target["parent"]["__ares_cloning__"]}else{result["parent"]=target["parent"]}continue}if(key=="_events"&&target instanceof PIXI.utils.EventEmitter){result["_events"]=PIXIUtils.cloneObject(target["_events"],false);for(var k in target["_events"]){var temp=target["_events"][k];result["_events"][k]=PIXIUtils.cloneObject(temp,false);if(temp.context==target){result["_events"][k].context=result}}continue}if(key=="children"&&target instanceof PIXI.Container){var children=result["children"];for(var j=0,lenJ=children.length;j<lenJ;j++){result["removeChildAt"](0).destroy()}children=target["children"];for(var j=0,lenJ=children.length;j<lenJ;j++){var child=PIXIUtils.cloneObject(children[j],true);result["addChild"](child)}continue}if(key=="vertexData"&&target instanceof PIXI.Sprite){result[key]=target[key]["slice"]();continue}var oriValue=target[key];if(oriValue&&oriValue["__ares_cloning__"]){result[key]=oriValue["__ares_cloning__"]}else{var value=PIXIUtils.cloneObject(oriValue,true);if(value!=null){try{result[key]=value}catch(err){}}}}delete target["__ares_cloning__"];return result};PIXIUtils.getViewportData=function(target){for(;target;target=target.parent){var temp=target["__ares_viewport__"];if(temp)return temp}return null};PIXIUtils._objectPool={};PIXIUtils._commonDisplayProps=["position","scale","pivot","skew","rotation","mask","filters"];return PIXIUtils}();exports.PIXIUtils=PIXIUtils},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var THRESHOLD_DRAGGING=3;var ELASTICITY_COEFFICIENT=1;var FRICTION_COEFFICIENT=.01;function shifting(to,from){var x=to.x-from.x;var y=to.y-from.y;return{x:x,y:y,distance:Math.sqrt(x*x+y*y)}}var ViewPortHandler=function(){function ViewPortHandler(target,options){this._movableH=false;this._movableV=false;this._dragging=false;this._direction=0;this._observers=[];this._target=target;this._options=options||{};this._viewPort=new PIXI.Rectangle;this._ticker=new PIXI.ticker.Ticker;this._ticker.add(this.onTick,this);this._speed=new PIXI.Point;this._masker=new PIXI.Graphics;target.mask=this._masker;target.interactive=true;target.on("pointerdown",this.onPointerDown,this);target.on("pointermove",this.onPointerMove,this);target.on("pointerup",this.onPointerUp,this);target.on("pointerupoutside",this.onPointerUp,this);this._observe=this.observe.bind(this)}ViewPortHandler.prototype.onPointerDown=function(evt){if(!this._downTarget){this._downTarget=evt.target;this._dragging=false;this._direction=0;this._speed.set(0,0);this._movableH=!this._options.lockV&&(this._target["width"]||0)>this._viewPort.width;this._movableV=!this._options.lockH&&(this._target["height"]||0)>this._viewPort.height;this._downPoint=this._lastPoint=evt.data.global.clone();this._lastTime=Date.now();this._downTarget.on("mouseup",this.onPointerUp,this);this._downTarget.on("mouseupoutside",this.onPointerUp,this);this._downTarget.on("pointerup",this.onPointerUp,this);this._downTarget.on("pointerupoutside",this.onPointerUp,this)}};ViewPortHandler.prototype.onPointerMove=function(evt){if(this._downTarget){var nowPoint=evt.data.global.clone();var s=shifting(nowPoint,this._lastPoint);if(!this._dragging&&shifting(nowPoint,this._downPoint).distance>THRESHOLD_DRAGGING){this._dragging=true}if(this._direction==0&&s.distance>0){if(this._options&&this._options.oneway){if(!this._movableV||this._movableH&&Math.abs(s.x)>Math.abs(s.y))this._direction=ViewPortHandler.DIRECTION_H;else this._direction=ViewPortHandler.DIRECTION_V}else{this._direction=ViewPortHandler.DIRECTION_H|ViewPortHandler.DIRECTION_V}}var dirH=(this._direction&ViewPortHandler.DIRECTION_H)>0;var dirV=(this._direction&ViewPortHandler.DIRECTION_V)>0;var sx=0,sy=0;if(dirH)sx=s.x;if(dirV)sy=s.y;this.moveTarget(sx,sy);this._lastPoint=nowPoint;var nowTime=Date.now();var deltaTime=nowTime-this._lastTime;this._speed.set(dirH&&this._movableH?s.x/deltaTime*5:0,dirV&&this._movableV?s.y/deltaTime*5:0);this._lastTime=nowTime}};ViewPortHandler.prototype.onPointerUp=function(evt){if(this._downTarget){this._downTarget.off("mouseup",this.onPointerUp,this);this._downTarget.off("mouseupoutside",this.onPointerUp,this);this._downTarget.off("pointerup",this.onPointerUp,this);this._downTarget.off("pointerupoutside",this.onPointerUp,this);if(this._dragging)evt.stopPropagation();this._downTarget=null;this._dragging=false;this._ticker.start()}};ViewPortHandler.prototype.getContentBounds=function(targetX,targetY){var bounds=this._target.getLocalBounds();bounds.x+=targetX;bounds.y+=targetY;return bounds};ViewPortHandler.prototype.getDelta=function(targetX,targetY){var bounds=this.getContentBounds(targetX,targetY);var deltaX=0;if(bounds.left>this._viewPort.left)deltaX=this._viewPort.left-bounds.left;else if(bounds.left<this._viewPort.left&&bounds.right<this._viewPort.right)deltaX=Math.min(this._viewPort.left-bounds.left,this._viewPort.right-bounds.right);var deltaY=0;if(bounds.top>this._viewPort.top)deltaY=this._viewPort.top-bounds.top;else if(bounds.top<this._viewPort.top&&bounds.bottom<this._viewPort.bottom)deltaY=Math.min(this._viewPort.top-bounds.top,this._viewPort.bottom-bounds.bottom);return{x:Math.round(deltaX),y:Math.round(deltaY)}};ViewPortHandler.prototype.moveTarget=function(x,y){if(this._movableH||this._movableV){this._ticker.stop();var d=this.getDelta(this._target.x,this._target.y);var pos=this._target.position;if(this._movableH)pos.x+=d.x!=0?x*.33/ELASTICITY_COEFFICIENT:x;if(this._movableV)pos.y+=d.y!=0?y*.33/ELASTICITY_COEFFICIENT:y;this._viewportData.twowayMoving=this._target.position.x!=pos.x&&this._target.position.y!=pos.y;this._target.position=pos;this.notify()}};ViewPortHandler.prototype.onTick=function(delta){if(this._target["_destroyed"]){this._ticker.stop();this._direction=0;return}var d=this.getDelta(this._target.x,this._target.y);var doneX=false;var doneY=false;if(d.x!=0){if(this._speed.x!=0){this._target.x+=this._speed.x*delta;var speedX=this._speed.x+d.x*ELASTICITY_COEFFICIENT*.01*delta;this._speed.x=speedX*this._speed.x<0?0:speedX}else{var moveX=d.x*delta*.07*ELASTICITY_COEFFICIENT;if(moveX!=0)this._target.x+=moveX}}else{if(this._speed.x!=0){this._target.x+=this._speed.x*delta;this._speed.x=this._speed.x*(1-FRICTION_COEFFICIENT);if(Math.abs(this._speed.x)<.5)this._speed.x=0}else{doneX=true}}if(d.y!=0){if(this._speed.y!=0){this._target.y+=this._speed.y*delta;var speedY=this._speed.y+d.y*ELASTICITY_COEFFICIENT*.01*delta;this._speed.y=speedY*this._speed.y<0?0:speedY}else{var moveY=d.y*delta*.07*ELASTICITY_COEFFICIENT;if(moveY!=0)this._target.y+=moveY}}else{if(this._speed.y!=0){this._target.y+=this._speed.y*delta;this._speed.y=this._speed.y*(1-FRICTION_COEFFICIENT);if(Math.abs(this._speed.y)<.5)this._speed.y=0}else{doneY=true}}this._viewportData.twowayMoving=!(doneX||doneY);this.notify();if(doneX&&doneY){this._ticker.stop();this._direction=0}};ViewPortHandler.prototype.getGlocalBounds=function(){var pos=this._target.parent.getGlobalPosition();var bounds=this._viewPort.clone();bounds.x+=pos.x-this._target.x;bounds.y+=pos.y-this._target.y;return bounds};ViewPortHandler.prototype.observe=function(observer){if(this._observers.indexOf(observer)<0){this._observers.push(observer)}};ViewPortHandler.prototype.notify=function(){for(var i=0,len=this._observers.length;i<len;i++){var observer=this._observers[i];observer(this._viewPort)}};ViewPortHandler.prototype.setViewPort=function(x,y,width,height){this._viewPort.x=x;this._viewPort.y=y;this._viewPort.width=width;this._viewPort.height=height;this._viewPortGlobal=this.getGlocalBounds();if(this._masker.parent!=this._target.parent&&this._target.parent){this._target.parent.addChild(this._masker)}this._masker.clear();this._masker.beginFill(0);this._masker.drawRect(x,y,width,height);this._masker.endFill();var d=this.getDelta(this._target.x,this._target.y);this._target.x+=d.x;this._target.y+=d.y;this._target["__ares_viewport__"]=this._viewportData={globalRange:this._viewPortGlobal,observe:this._observe,twowayMoving:false}};ViewPortHandler.DIRECTION_H=1;

ViewPortHandler.DIRECTION_V=2;return ViewPortHandler}();exports.ViewPortHandler=ViewPortHandler}])});